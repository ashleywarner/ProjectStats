require([""],function(){!function(a,b){History.Adapter.bind(a,"statechange",function(){History.getState()})}(window),d3.csv("output.json",function(a,b){function c(a){d3.select(this).call(a)}function d(){A.each(c),B.each(c),C.each(c),d3.select("#active").text(k(q.value()))}function e(a){return new Date(a)}function f(a){for(var b=window.location.search.substring(1),c=b.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");if(e[0]==a)return e[1]}return!1}function g(){var a=[location.pathname.substring(location.pathname.lastIndexOf("/")+1)];""===a[0]&&(a[0]="index.html"),D&&a.push("user="+encodeURI(D)),E&&a.push("startDate="+Date.parse(E)),F&&a.push("endDate="+Date.parse(F)),G&&a.push("startTime="+parseInt(G,10)),H&&a.push("endTime="+parseInt(H,10));var b=a.join("&");return b=b.replace(/&/,"?")}function h(a){var b=n.entries(r.top(1e3));a.each(function(){var a=d3.select(this).selectAll(".date").data(b,function(a){return a.key});a.enter().append("div").attr("class","date").append("div").attr("class","day").append("span").text(function(a){return l(a.values[0].date)}),a.exit().remove();var c=a.order().selectAll(".commit").data(function(a){return a.values},function(a){return a.index}),d=c.enter().append("div").attr("class","commit");d.append("div").attr("class","time").text(function(a){return m(a.date)}),d.append("div").attr("class","author").text(function(a){return a.author}),c.exit().remove(),c.order()})}function i(a){var b=o.entries(r.top(1e5));a.each(function(){b.sort(function(a,b){return b.values.length>a.values.length?1:-1});var a=d3.select(this).selectAll(".user-info").data(b,function(a){return a.key});a.select(".commit-count").text(function(a){return a.values.length.toLocaleString()+" commits"}),a.enter().append("div").attr("class","user-info").attr("data-user",function(a){return a.values[0].author}).attr("onclick",function(a){return"javascript:filterUser('"+a.values[0].author+"')"}).append("div").attr("class","user-name").append("span").text(function(a){return a.values[0].author}).append("span").attr("class","commit-count").text(function(a){return a.values.length.toLocaleString()+" commits"}),a.exit().remove(),a.order()})}function j(a){function b(b){function e(b){for(var d,e=[],f=-1,g=b.length;++f<g;)d=b[f],e.push("M",c(d.key),",",j,"V",k(d.value),"h"+(a-w)+"V",j);return e.join("")}function g(a){var b=+("e"==a),c=b?1:-1,d=j/3;return"M"+.5*c+","+d+"A6,6 0 0 "+b+" "+6.5*c+","+(d+6)+"V"+(2*d-6)+"A6,6 0 0 "+b+" "+.5*c+","+2*d+"ZM"+2.5*c+","+(d+8)+"V"+(2*d-8)+"M"+4.5*c+","+(d+8)+"V"+(2*d-8)}var h=c.range()[1],j=k.range()[0];k.domain([0,f.top(1)[0].value]),b.each(function(){var a=d3.select(this.parentNode),b=a.select("g");if(b.empty()){a.select(".title").append("a").attr("href","javascript:reset("+l+")").attr("class","reset").text("Remove filter").style("display","none"),b=a.append("svg").attr("width",h+i.left+i.right).attr("height",j+i.top+i.bottom).append("g").attr("transform","translate("+i.left+","+i.top+")"),b.append("clipPath").attr("id","clip-"+l).append("rect").attr("width",h).attr("height",j),b.selectAll(".bar").data(["background","foreground"]).enter().append("path").attr("class",function(a){return a+" bar"}).datum(f.all()),b.selectAll(".foreground.bar").attr("clip-path","url(#clip-"+l+")"),b.append("g").attr("class","axis").attr("transform","translate(0,"+j+")").call(m);var k=b.append("g").attr("class","brush").call(n);k.selectAll("rect").attr("height",j),k.selectAll(".resize").append("path").attr("d",g)}if(d)if(d=!1,b.selectAll(".brush").call(n),a.select(".title a").style("display",n.empty()?"none":null),n.empty())b.selectAll("#clip-"+l+" rect").attr("x",0).attr("width",h);else{var o=n.extent();b.selectAll("#clip-"+l+" rect").attr("x",c(o[0])).attr("width",c(o[1])-c(o[0]))}b.selectAll(".bar").attr("d",e)})}j.id||(j.id=0);var c,d,e,f,h,i={top:0,right:20,bottom:20,left:10},k=d3.scale.linear().range([100,0]),l=j.id++,m=d3.svg.axis().orient("bottom"),n=d3.svg.brush();return n.on("brushstart.chart",function(){var a=d3.select(this.parentNode.parentNode.parentNode);a.select(".title a").style("display",null)}),n.on("brush.chart",function(){var a=d3.select(this.parentNode),b=n.extent();h&&a.select(".brush").call(n.extent(b=b.map(h))).selectAll(".resize").style("display",null),a.select("#clip-"+l+" rect").attr("x",c(b[0])).attr("width",c(b[1])-c(b[0])),b[0]<24?(G=b[0],H=b[1]):(E=b[0],F=b[1]),e.filterRange(b),History.pushState({},window.title,g())}),n.on("brushend.chart",function(){if(n.empty()){var a=d3.select(this.parentNode.parentNode.parentNode);a.select(".title a").style("display","none"),a.select("#clip-"+l+" rect").attr("x",null).attr("width","100%"),G=void 0,H=void 0,E=void 0,F=void 0,e.filterAll(),History.pushState({},window.title,g())}}),b.margin=function(a){return arguments.length?(i=a,b):i},b.x=function(a){return arguments.length?(c=a,m.scale(c),n.x(c),b):c},b.y=function(a){return arguments.length?(k=a,b):k},b.dimension=function(a){return arguments.length?(e=a,b):e},b.filter=function(a){return a?(n.extent(a),e.filterRange(a)):(n.clear(),e.filterAll()),d=!0,b},b.group=function(a){return arguments.length?(f=a,b):f},b.round=function(a){return arguments.length?(h=a,b):h},d3.rebind(b,n,"on")}b=b.filter(function(a){var b=new Date-31536e6,c=new Date,d=e(a.date);return d>b&&c>d?!0:!1});var k=d3.format(",d"),l=d3.time.format("%B %d, %Y"),m=d3.time.format("%I:%M %p"),n=d3.nest().key(function(a){return d3.time.day(a.date)}),o=d3.nest().key(function(a){return a.author});b.forEach(function(a,b){a.index=b,a.date=e(a.date)});var p=crossfilter(b),q=p.groupAll(),r=p.dimension(function(a){return a.date}),s=p.dimension(function(a){return a.author}),t=r.group(d3.time.day),u=(r.group(d3.time.week),p.dimension(function(a){return a.date.getHours()+a.date.getMinutes()/60})),v=u.group(Math.floor),w=1,x=($(".graph.date").width()-30)/365,y=($(".graph.time").width()-30)/24,z=[j(x).dimension(r).group(t).round(d3.time.day.round).x(d3.time.scale().domain([new Date-31536e6,new Date]).rangeRound([0,365*x])),j(y).dimension(u).group(v).x(d3.scale.linear().domain([0,24]).rangeRound([0,24*y]))],A=d3.selectAll(".chart .placeholder").data(z).each(function(a){a.on("brush",d).on("brushend",d)}),B=d3.selectAll(".panel.commit .list").data([h]),C=d3.selectAll(".panel.user .list").data([i]);d3.selectAll("#total").text(k(p.size())),d(),window.filter=function(a){a.forEach(function(a,b){z[b].filter(a)}),d()},window.reset=function(a){z[a].filter(null),G=void 0,H=void 0,E=void 0,F=void 0,History.pushState({},window.title,g()),d()},window.filterUser=function(a){$(".user-info").removeClass("selected"),D=a,a?($(".user-info[data-user='"+a+"']").addClass("selected"),s.filterFunction(function(b){return b==a}),$(".panel.user .reset").show()):($(".panel.user .reset").hide(),s.filterAll()),History.pushState({user:a},window.title,g()),d()};var D=f("user"),E=f("startDate"),F=f("endDate"),G=f("startTime"),H=f("endTime");D&&filterUser(decodeURI(D)),E&&(E=new Date(parseInt(E,10))),F&&(F=new Date(parseInt(F,10))),G&&(G=parseInt(G,10)),H&&(H=parseInt(H,10));var I,J;void 0!=E&&void 0!=F&&(I=[E,F]),void 0!=G&&void 0!=H&&(J=[G,H]),(G&&H||E&&F)&&filter([I,J])})}),require.config({paths:{},shim:{}});